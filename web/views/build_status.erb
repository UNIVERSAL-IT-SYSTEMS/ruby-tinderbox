<div id="build_status">
	<h3>Build Status (CI)</h3>
</div>

<%total_packages = Package.count%>
<%succeeded_packages = Build.where(result: 'succeeded').count%>
<%timed_out_packages = Build.where(result: 'timed out').count%>
<%failed_packages = Build.where(result: 'failed').count%>
<div class="progress">
	<div class="progress-bar progress-bar-success" style="width: <%=((succeeded_packages.to_f / total_packages.to_f) * 100).to_i%>%"></div>
	<div class="progress-bar progress-bar-info" style="width: <%=((timed_out_packages.to_f / total_packages.to_f) * 100).to_i%>%"></div>
	<div class="progress-bar progress-bar-danger" style="width: <%=((failed_packages.to_f / total_packages.to_f) * 100).to_i%>%"></div>
</div>

<table id="sortable" class="table table-bordered table-condensed">
	<thead>
	<tr>
		<th>Package</th>
		<th>Build Date</th>
		<th>Build Result</th>
		<th>Build History</th>
	</tr>
	</thead>
	<%Package.order{[category, lower(name), version]}.each do |package|%>
	<%build = Build.where(package_id: package[:identifier]).order(:time).last%>
	<%next if build.nil?%>
	<%result = 'success' if build[:result] == 'succeeded'%>
	<%result = 'info' if build[:result] == 'timed out'%>
	<%result = 'danger' if build[:result] == 'failed'%>
	<tr>
		<td width="52%">
			<%=package[:identifier]%>
		</td>
		<td width="17%">
			<%=Time.at(build[:time].to_i).strftime('%Y-%m-%d')%>
		</td>
		<td width="17%" class="<%=result%>">
			<a href="/build_logs/<%=package[:identifier]%>"><%=build[:result].camelcase%></a>
		</td>
		<td width="14%">
			<a href="/build_history/<%=package[:identifier]%>"><%=Build.where(package_id: package[:identifier]).count%> Build(s)</a>
		</td>
	</tr>
	<%end%>
</table>
