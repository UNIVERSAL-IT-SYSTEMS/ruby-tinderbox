require_relative 'app'

task :test do
	Dir.glob('./test/test_*.rb') { |f| require f }
end

namespace :db do

	DB.loggers << Logger.new($stdout)

	task :migrate do
		Sequel.extension :migration
		Sequel::Migrator.run(DB, 'db/migrations')
	end

	task :package_clear do
		packages = DB[:packages]
		packages.delete
	end

	task :ci_clear do
		builds = DB[:builds]
		builds.delete
	end

	task :package_update do
		package_update
	end

	task :ci_update do
		ci_update
	end

end

namespace :aws do

	task :ci_full_run do
		ci_run(0)
	end

	task :ci_limited_run do
		ci_run(5)
	end

end
